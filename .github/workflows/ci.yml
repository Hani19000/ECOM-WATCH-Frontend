name: CI - Validation Frontend

on:
  push:
    branches: [main, develop]
    paths:
      - "ECOMWATCH/**"
      - ".github/workflows/ci.yml"
  pull_request:
    branches: [main, develop]
    paths:
      - "ECOMWATCH/**"
      - ".github/workflows/ci.yml"
  workflow_dispatch:

# Annule les exécutions précédentes si un nouveau commit est poussé sur la même branche
concurrency:
  group: ci-${{ github.ref }}
  cancel-in-progress: true

jobs:
  validation:
    name: Validation et Build
    runs-on: ubuntu-latest
    # Définit le dossier de travail par défaut pour toutes les commandes 'run' de ce job
    defaults:
      run:
        working-directory: ./ECOMWATCH

    steps:
      - name: Checkout du code
        uses: actions/checkout@v4

      - name: Configuration de Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"
          cache-dependency-path: "./ECOMWATCH/package-lock.json"

      - name: Installation des dependances
        run: npm ci --prefer-offline

      - name: Audit de securite
        # 'continue-on-error' permet au pipeline de ne pas échouer totalement si des failles mineures sont trouvées
        run: npm audit --audit-level=high
        continue-on-error: true

      - name: Linting du code
        run: npm run lint

      - name: Test de compilation (Build)
        run: npm run build
        env:
          NODE_ENV: production